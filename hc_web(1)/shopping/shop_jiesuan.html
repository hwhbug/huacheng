<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/style.css" rel="stylesheet" />
		<link href="../css/iconfont.css" rel="stylesheet" />
		<link href="../css/cross-down.css" rel="stylesheet" />
		<script src="../js/jquery-1.9.1.min.js" type="text/javascript"></script>
		<style>
			.left_jiage {
				float: left;
				padding: 10px 0;
				margin-top: 6px;
			}
			
			html {
				background: #FFFFFF;
			}
			
			.zhifu {
				width: 30%;
				float: right;
				background: #CF2D28;
				color: #FFFFFF;
				border: none;
				margin-top: 25px;
			}
			
			.footer {
				padding: 0 10px;
				border-top: 1px solid #EEE;
			}
			
			.mui-slider-right {
				position: relative;
			}
			
			.mui-slider-right .mui-btn {
				position: relative;
				top: 0px;
			}
			
			.huise {
				position: relative !important;
			}
			
			.mui-table-view-cell:after {
				display: none;
			}
			
			p {
				margin-bottom: 0;
				line-height: 1.5em;
			}
			
			.jiesuan li {
				border-bottom: 1px solid #EEEEEE;
				padding: 10px 0;
				`
			}
			
			.mui-table-view-cell {
				font-size: 16px;
			}
		</style>
	</head>

	<body>

		<!-- 侧滑导航根容器 -->

		<header class="mui-bar mui-bar-nav">
			<a id="back_index" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">结算中心</h1>
		</header>

		<!--主界面区域-->
		<div class="repair3_table mui-content jiesuan">
			<ul id="myorders">
				<!--<li>
					<p>蓝月亮洗衣液x1<span class="font-red mui-pull-right">￥50.00</span></p>
				</li>-->
			</ul>

		</div>
		<!-- FOOTER区域-->
		<nav class="mui-bar mui-bar-tab footer">
			<div class="dizhi" style="line-height: 30px; color:#666666;">
				<!--<p id="userinfo" class="black">
					收货人：李晨源 <span class="mui-pull-right" ：>联系电话：15035667535</span>
				</p>
				<p id="default_address"></p>
				<p>山西省晋中市榆次区中都北路军安小区对面易魔方数字设计中心 </p>
				-->
			</div>
			<p class="center font-blue" id="address">更换地址</p>
			<p class="black">支付方式</p>
			<ul class="mui-table-view mui-table-view-radio">
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right">
						华晟一卡通
					</a>
				</li>
				<li class="mui-table-view-cell mui-selected">
					<a class="mui-navigate-right">
						支付宝
					</a>
				</li>
			</ul>

			<div class="clear"></div>
			<div class="left_jiage">

				<strong>共计：<span id="mx_jiage" class="font-red mx_jiage">￥</span></strong>
				<p id="jifeng">本次消费可获得积分：</p>
			</div>
			<button id="zhifu" class="zhifu">
				去结算
			</button>
		</nav>

		<script src="../js/mui.min.js"></script>
		<script>
			mui('.mui-scroll-wrapper').scroll();
			window.addEventListener('newsId', function(event) {
				//获得事件参数
				var cuxiao_id = event.detail.id;
				mui.ajax('http://101.201.196.202:82/MyOrders/index', {
					data: {
						"ids": cuxiao_id.toString()
					},
					dataType: 'json', //服务器返回json格式数据
					type: 'Post', //HTTP请求类型,
					timeout: 10000, //超时时间设置为10秒；
					success: function(data) {
						var myorders = "";
						var totalprice = 0;
						for (var i = 0; i < data.length; i++) {
							myorders += "<li><p>" + data[i].OrdersName + "<span class=\"font-red mui-pull-right\">￥" + data[i].TotalPrice + "</span></p></li>";
							totalprice += data[i].TotalPrice;
						}
						$("#myorders").html(myorders);
						$("#mx_jiage").html("￥" + totalprice);
						$("#jifeng").html("本次消费可获得积分：" + totalprice);
					}
				})
			})
			//*****************************获取默认收货地址**********************************
			mui.ajax('http://101.201.196.202:82/DeliveryAddress/Default', {
				data: {},
				dataType: 'json', //服务器返回json格式数据
				type: 'Post', //HTTP请求类型,
				timeout: 10000, //超时时间设置为10秒；
				success: function(data) {
					if(data.ConsigneeName!=null){
						$(".dizhi").html("<p id=\"userinfo\" class=\"black\">收货人："+data.ConsigneeName+" <span class=\"mui-pull-right\" ：>联系电话："+data.ConsigneePhone+"</span></p><p id=\"default_address\">地址："+data.Address+"</p>");
					}
					
				}
			})
			//**************************收货地址管理*****************************
			document.getElementById('address').addEventListener('tap', function() {
				//打开关于页面
				mui.openWindow({
					url: 'shop_dizhi.html',
					id: 'shop_dizhi'
				});
			});
			
			//*****************************以下为调用支付宝开始支付操作****************************
			var channels = null;
			// 监听plusready事件  
			document.addEventListener("plusready", function() {
				// 扩展API加载完毕，现在可以正常调用扩展API
				plus.payment.getChannels(function(s) {
					channels = s;
				}, function(e) {
					alert("获取支付通道列表失败：" + e.message);
				});
			}, false);
			document.getElementById("zhifu").addEventListener("tap",function(){
				
				// 必须从业务服务器获取支付信息
				var statement = "...";
				plus.payment.request(channels, statement, function() {
					alert("支付操作成功！");
				}, function(e) {
					alert("支付失败：" + e.message);
				});
			})
			
		</script>

	</body>

</html>